#!/usr/bin/env sh

now=$(date +'%m/%d/%Y %H:%M:%S')
docker_version=$(docker -v)
disk_usage=$(df -h /)
docker_stats=$(docker stats --no-stream --all)
memory_stats=$(cat /proc/meminfo | grep -E "Mem|Cached|Swap|ctive")
uptime="$(uptime) [1m, 5m, 15m]"

cat > "$STATS_FILE" <<- EOM
HEARTBEAT LOG AT $now

=======================================================================================================================
Docker version
=======================================================================================================================
$docker_version

=======================================================================================================================
Uptime
=======================================================================================================================
$uptime

=======================================================================================================================
Containers stats
=======================================================================================================================
$docker_stats

=======================================================================================================================
Disk Usage
=======================================================================================================================
$disk_usage

=======================================================================================================================
Memory Usage
=======================================================================================================================
$memory_stats

END OF LOG
EOM

echo "Heartbeat created for timestamp $now!"
